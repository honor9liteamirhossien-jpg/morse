<!DOCTYPE html>
<html lang="fa">
<head>
  <meta charset="UTF-8" />
  <title>Ù…Ø¨Ø¯Ù„ Ú©Ø¯ Ù…ÙˆØ±Ø³</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    /* ØªÙ…â€ŒÙ‡Ø§ (Û¶ Ø­Ø§Ù„Øª Ø¯Ø± Ù„ÙˆÙ¾) */
    body.theme-light { --bg:#fdfbfb; --bg2:#ebedee; --fg:#333; --card:rgba(255,255,255,0.9); --btn1a:#6ec1e4; --btn1b:#81e6a8; --accent:#f78fb3; --output-bg:#eafaf1; }
    body.theme-dark  { --bg:#1e1e2f; --bg2:#2c2c3c; --fg:#f0f0f0; --card:rgba(44,44,60,0.9); --btn1a:#81e6a8; --btn1b:#f78fb3; --accent:#6ec1e4; --output-bg:#44475a; }
    body.theme-blueRed { --bg:#eff6ff; --bg2:#ffe5e5; --fg:#2c3e50; --card:rgba(255,255,255,0.95); --btn1a:#3b82f6; --btn1b:#ef4444; --accent:#60a5fa; --output-bg:#e6f0ff; }
    body.theme-whitePink { --bg:#fff7fb; --bg2:#ffeef7; --fg:#4b5563; --card:rgba(255,255,255,0.95); --btn1a:#f78fb3; --btn1b:#fbcfe8; --accent:#ff7aa2; --output-bg:#fff0f6; }
    body.theme-tealPurple { --bg:#e6fffa; --bg2:#ede9fe; --fg:#374151; --card:rgba(255,255,255,0.95); --btn1a:#14b8a6; --btn1b:#8b5cf6; --accent:#22d3ee; --output-bg:#e5fffb; }
    body.theme-sunset { --bg:#fff5e6; --bg2:#ffe4e1; --fg:#3d3d3d; --card:rgba(255,255,255,0.95); --btn1a:#fb923c; --btn1b:#f43f5e; --accent:#fdba74; --output-bg:#fff0e6; }

    body {
      font-family: "Tahoma", sans-serif;
      background: linear-gradient(135deg, var(--bg), var(--bg2));
      color: var(--fg);
      text-align: center;
      padding: 90px 30px 30px; /* ÙØ¶Ø§ÛŒ Ø¨Ø§Ú©Ø³ Ù¾ÛŒØ§Ù… Ø«Ø§Ø¨Øª */
      transition: background 0.4s, color 0.4s;
      direction: rtl;
    }
    .container {
      background: var(--card);
      padding: 25px;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.12);
      max-width: 900px;
      margin: auto;
    }
    h2 { color: var(--fg); margin-bottom: 10px; }

    .row { margin-top: 10px; display: flex; gap: 10px; justify-content: center; flex-wrap: wrap; }

    /* ÙˆØ±ÙˆØ¯ÛŒâ€ŒÙ‡Ø§ + Ù¾Ø§Ú©â€ŒÚ©Ø±Ø¯Ù† Ø³Ø±ÛŒØ¹ (Ø¢ÛŒÚ©ÙˆÙ† Ø³Ø·Ù„ Ø¨Ø§Ù„Ø§-Ø±Ø§Ø³Øª) */
    .input-wrap { position: relative; width: 90%; margin: 8px auto; }
    .input-wrap input[type="text"] {
      width: 100%; padding: 12px 40px 12px 12px;
      border: 1px solid #ccc; border-radius: 10px; font-size: 16px;
      background: rgba(255,255,255,0.9); color: var(--fg);
      transition: background 0.3s, color 0.3s, border 0.3s;
    }
    .clear-btn {
      position: absolute; top: 8px; right: 8px;
      background: transparent; border: none; cursor: pointer; padding: 4px;
      display: inline-flex; align-items: center; justify-content: center;
    }
    .clear-btn svg { width: 18px; height: 18px; fill: #888; }
    .clear-btn:hover svg { fill: #555; }

    /* Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ */
    button {
      background: linear-gradient(135deg, var(--btn1a), var(--btn1b));
      color: white; border: none; padding: 10px 16px; margin: 6px 0;
      border-radius: 12px; font-size: 15px; cursor: pointer;
      display: inline-flex; align-items: center; gap: 8px;
      transition: transform 0.1s ease, opacity 0.3s ease;
    }
    button:hover { opacity: 0.92; transform: translateY(-1px); }
    .copy-btn { background: linear-gradient(135deg, var(--accent), var(--btn1a)); }
    .paste-btn { background: linear-gradient(135deg, #ff9f43, #ff6b6b); }
    .lang-btn { background: linear-gradient(135deg, var(--btn1a), var(--accent)); }

    /* Ø®Ø±ÙˆØ¬ÛŒâ€ŒÙ‡Ø§ */
    p.output {
      background: var(--output-bg);
      padding: 12px; border-radius: 10px; min-height: 40px;
      margin-top: 10px; font-size: 18px; word-wrap: break-word;
      text-align: left; direction: ltr;
    }
    #outputMorse { font-family: "Courier New", monospace; position: relative; }

    /* Ø§Ø³Ù¾ÛŒÚ©Ø± Ø¨Ø§Ù„Ø§-Ø±Ø§Ø³Øª Ø¨ÛŒØ±ÙˆÙ† Ø§Ø² Ú©Ø§Ø¯Ø± Ø®Ø±ÙˆØ¬ÛŒ Ù…ÙˆØ±Ø³ */
    .morse-header {
      display: flex; align-items: center; justify-content: space-between;
      width: 90%; margin: 4px auto -2px;
    }
    .morse-header .title { font-size: 14px; color: var(--fg); opacity: 0.8; }
    .speaker-btn {
      background: transparent; border: none; cursor: pointer; padding: 4px;
      display: inline-flex; align-items: center; justify-content: center;
    }
    .speaker-btn svg { width: 20px; height: 20px; fill: #555; }
    .speaker-btn:hover svg { fill: #333; }

    /* Ø¨Ø§Ú©Ø³ Ù¾ÛŒØ§Ù… Ø«Ø§Ø¨Øª Ø¨Ø§Ù„Ø§ÛŒ ØµÙØ­Ù‡ Ø¨Ø§ Ø¢ÛŒÚ©ÙˆÙ† SVG */
    #messageBox {
      position: fixed; top: 12px; left: 50%; transform: translateX(-50%);
      padding: 10px 18px; border-radius: 10px; font-size: 15px;
      display: none; max-width: 720px; text-align: center; z-index: 9999;
      box-shadow: 0 6px 16px rgba(0,0,0,0.12);
      background: #fff; color: #333;
    }
    #messageBox.success { background: #d4edda; color: #155724; }
    #messageBox.error   { background: #f8d7da; color: #721c24; }
    #messageBox.warning { background: #fff3cd; color: #856404; }
    #messageBox svg { vertical-align: middle; margin-left: 6px; }
  </style>
</head>
<body class="theme-light">
  <!-- Ø¨Ø§Ú©Ø³ Ù¾ÛŒØ§Ù… Ø«Ø§Ø¨Øª -->
  <div id="messageBox"></div>

  <div class="container">
    <h2>ğŸ”¡ Ù…Ø¨Ø¯Ù„ Ú©Ø¯ Ù…ÙˆØ±Ø³</h2>

    <!-- Ø³ÙˆØ¦ÛŒÚ† ØªÙ…â€ŒÙ‡Ø§ (Ù„ÙˆÙ¾) -->
    <div class="row">
      <button onclick="cycleTheme()">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="white" viewBox="0 0 24 24"><path d="M12 6v3l4-4-4-4v3C6.48 4 2 8.48 2 14c0 3.31 1.34 6.31 3.5 8.5l1.42-1.42A9.96 9.96 0 0 1 4 14c0-4.42 3.58-8 8-8zm7.5 1.5L18.08 8.92A9.96 9.96 0 0 1 20 14c0 4.42-3.58 8-8 8v-3l-4 4 4 4v-3c5.52 0 10-4.48 10-10 0-3.31-1.34-6.31-3.5-8.5z"/></svg>
        ØªØºÛŒÛŒØ± ØªÙ…
      </button>
    </div>

    <!-- Ù…ØªÙ† â Ù…ÙˆØ±Ø³ -->
    <h3>Ù…ØªÙ† â Ù…ÙˆØ±Ø³</h3>
    <div class="input-wrap">
      <input type="text" id="inputText" placeholder="Ù…ØªÙ† ÛŒØ§ Ø¹Ø¯Ø¯ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯">
      <button class="clear-btn" onclick="clearInput('inputText')" title="Ù¾Ø§Ú© Ú©Ø±Ø¯Ù†">
        <!-- Ø³Ø·Ù„ -->
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9 3h6l1 2h5v2H3V5h5l1-2zm1 6h2v9h-2V9zm4 0h2v9h-2V9zM7 9h2v9H7V9z"/></svg>
      </button>
    </div>
    <div class="row">
      <button onclick="convertToMorse()">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="white" viewBox="0 0 24 24"><path d="M12 4l1.41 1.41L8.83 10H20v2H8.83l4.58 4.59L12 18l-8-8 8-8z"/></svg>
        ØªØ¨Ø¯ÛŒÙ„
      </button>
      <button class="copy-btn" onclick="copyText('outputMorse')">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="white" viewBox="0 0 24 24"><path d="M16 1H4a2 2 0 0 0-2 2v14h2V3h12V1zm3 4H8a2 2 0 0 0-2 2v16h14a2 2 0 0 0 2-2V5z"/></svg>
        Ú©Ù¾ÛŒ
      </button>
      <button class="paste-btn" onclick="pasteText('inputText')">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="white" viewBox="0 0 24 24"><path d="M19 3H5c-1.1 0-2 .9-2 2v14h2V5h14V3zm-2 4H8a2 2 0 0 0-2 2v12h12a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2z"/></svg>
        Ø¬Ø§ÛŒÚ¯Ø°Ø§Ø±ÛŒ
      </button>
    </div>

    <!-- Ù‡Ø¯Ø± Ø®Ø±ÙˆØ¬ÛŒ Ù…ÙˆØ±Ø³: Ø§Ø³Ù¾ÛŒÚ©Ø± Ø¨Ø§Ù„Ø§-Ø±Ø§Ø³Øª -->
    <div class="morse-header">
      <span class="title">Ø®Ø±ÙˆØ¬ÛŒ Ù…ÙˆØ±Ø³</span>
      <button class="speaker-btn" onclick="playMorseAudio()" title="Ù¾Ø®Ø´ ØµÙˆØªÛŒ Ù…ÙˆØ±Ø³">
        <!-- Ø§Ø³Ù¾ÛŒÚ©Ø± -->
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 9v6h4l5 4V5L7 9H3zm13.5 3a3.5 3.5 0 0 0-2.1-3.2l1-1.7A5.5 5.5 0 0 1 20 12a5.5 5.5 0 0 1-4.6 5.4l-1-1.7a3.5 3.5 0 0 0 2.1-3.2z"/></svg>
      </button>
    </div>
    <p id="outputMorse" class="output"></p>

    <!-- Ø³ÙˆØ¦ÛŒÚ† Ø²Ø¨Ø§Ù† ØªØ¨Ø¯ÛŒÙ„ Ù…ÙˆØ±Ø³ Ø¨Ù‡ Ù…ØªÙ†: Ø¯Ù‚ÛŒÙ‚Ø§ Ø¨ÛŒÙ† Ø¯Ùˆ Ø¨Ø®Ø´ -->
    <div class="row">
      <button class="lang-btn" onclick="toggleLang()">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="white" viewBox="0 0 24 24"><path d="M12 2a10 10 0 1 0 10 10A10.012 10.012 0 0 0 12 2z"/></svg>
        Ø²Ø¨Ø§Ù† ØªØ¨Ø¯ÛŒÙ„ Ù…ÙˆØ±Ø³ Ø¨Ù‡ Ù…ØªÙ†: <span id="langLabel">ÙØ§Ø±Ø³ÛŒ</span>
      </button>
    </div>

    <!-- Ù…ÙˆØ±Ø³ â Ù…ØªÙ† -->
    <h3>Ù…ÙˆØ±Ø³ â Ù…ØªÙ†</h3>
    <div class="input-wrap">
      <input type="text" id="inputMorse" placeholder="Ú©Ø¯ Ù…ÙˆØ±Ø³ (ÛŒÚ© ÙØ§ØµÙ„Ù‡ Ø¨ÛŒÙ† Ø­Ø±ÙˆÙØŒ Ø³Ù‡ ÙØ§ØµÙ„Ù‡ Ø¨ÛŒÙ† Ú©Ù„Ù…Ø§Øª)">
      <button class="clear-btn" onclick="clearInput('inputMorse')" title="Ù¾Ø§Ú© Ú©Ø±Ø¯Ù†">
        <!-- Ø³Ø·Ù„ -->
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9 3h6l1 2h5v2H3V5h5l1-2zm1 6h2v9h-2V9zm4 0h2v9h-2V9zM7 9h2v9H7V9z"/></svg>
      </button>
    </div>
    <div class="row">
      <button onclick="convertToText()">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="white" viewBox="0 0 24 24"><path d="M12 4l1.41 1.41L8.83 10H20v2H8.83l4.58 4.59L12 18l-8-8 8-8z"/></svg>
        ØªØ¨Ø¯ÛŒÙ„
      </button>
      <button class="copy-btn" onclick="copyText('outputText')">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="white" viewBox="0 0 24 24"><path d="M16 1H4a2 2 0 0 0-2 2v14h2V3h12V1zm3 4H8a2 2 0 0 0-2 2v16h14a2 2 0 0 0 2-2V5z"/></svg>
        Ú©Ù¾ÛŒ
      </button>
      <button class="paste-btn" onclick="pasteText('inputMorse')">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="white" viewBox="0 0 24 24"><path d="M19 3H5c-1.1 0-2 .9-2 2v14h2V5h14V3zm-2 4H8a2 2 0 0 0-2 2v12h12a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2z"/></svg>
        Ø¬Ø§ÛŒÚ¯Ø°Ø§Ø±ÛŒ
      </button>
    </div>
    <p id="outputText" class="output" style="direction: rtl; text-align: right;"></p>
  </div>

  <script>
    /* Ù†Ú¯Ø§Ø´Øªâ€ŒÙ‡Ø§ */
    const morseMapEn = {
      'A':'.-','B':'-...','C':'-.-.','D':'-..','E':'.','F':'..-.','G':'--.','H':'....',
      'I':'..','J':'.---','K':'-.-','L':'.-..','M':'--','N':'-.','O':'---','P':'.--.',
      'Q':'--.-','R':'.-.','S':'...','T':'-','U':'..-','V':'...-','W':'.--','X':'-..-','Y':'-.--','Z':'--..'
    };
    const morseDigits = { '0':'-----','1':'.----','2':'..---','3':'...--','4':'....-','5':'.....','6':'-....','7':'--...','8':'---..','9':'----.' };
    const morsePunct = {
      '.':'.-.-.-', ',':'--..--', '?':'..--..', 'ØŸ':'..--..', '!':'-.-.--', ':':'---...', ';':'-.-.-.',
      '(':'-.--.', ')':'-.--.-', "'":'.----.', '"':'.-..-.', '/':'-..-.', '&':'.-...', '=':'-...-',
      '+':'.-.-.', '-':'-....-', '_':'..--.-', '$':'...-..-', '@':'.--.-.'
    };
    const morseMapFa = {
      'Ø§':'.-','Ø¨':'-...','Ù¾':'.--.','Øª':'-','Ø«':'-.-.','Ø¬':'.---','Ú†':'----','Ø­':'....','Ø®':'---.','Ø¯':'-..',
      'Ø°':'--..','Ø±':'.-.','Ø²':'--..','Ú˜':'--.-','Ø³':'...','Ø´':'---','Øµ':'...-','Ø¶':'...--','Ø·':'..-','Ø¸':'..--',
      'Ø¹':'..-..','Øº':'--.','Ù':'..-.','Ù‚':'--.-','Ú©':'-.-','Ú¯':'--.','Ù„':'.-..','Ù…':'--','Ù†':'-.','Ùˆ':'.--','Ù‡':'....','ÛŒ':'..'
    };

    /* Ù…Ø¹Ú©ÙˆØ³â€ŒÙ‡Ø§ */
    const revEn = {}; for (let k in morseMapEn) revEn[morseMapEn[k]] = k;
    const revDigits = {}; for (let k in morseDigits) revDigits[morseDigits[k]] = k;
    const revPunct = {}; for (let k in morsePunct) revPunct[morsePunct[k]] = k;
    const revFa = {}; for (let k in morseMapFa) revFa[morseMapFa[k]] = k;

    /* Ø§Ø±Ù‚Ø§Ù… ÙØ§Ø±Ø³ÛŒ â†” Ù„Ø§ØªÛŒÙ† */
    const faToEnDigit = { 'Û°':'0','Û±':'1','Û²':'2','Û³':'3','Û´':'4','Ûµ':'5','Û¶':'6','Û·':'7','Û¸':'8','Û¹':'9' };
    const enToFaDigit = { '0':'Û°','1':'Û±','2':'Û²','3':'Û³','4':'Û´','5':'Ûµ','6':'Û¶','7':'Û·','8':'Û¸','9':'Û¹' };

    /* Ø²Ø¨Ø§Ù† ØªØ±Ø¬ÛŒØ­ÛŒ Ø¨Ø±Ø§ÛŒ Ù…ÙˆØ±Ø³ â Ù…ØªÙ† (fa/en) */
    let currentLang = 'fa';

    /* ØªÙ…â€ŒÙ‡Ø§ Ù„ÙˆÙ¾ */
    const themes = ['theme-light','theme-dark','theme-blueRed','theme-whitePink','theme-tealPurple','theme-sunset'];
    function cycleTheme(){
      const body = document.body;
      const idx = themes.findIndex(t => body.classList.contains(t));
      const next = themes[(idx + 1) % themes.length];
      themes.forEach(t => body.classList.remove(t));
      body.classList.add(next);
      showMessage('success', 'ğŸ¨ ØªÙ… ØªØºÛŒÛŒØ± Ú©Ø±Ø¯: ' + next.replace('theme-',''));
    }

    /* Ø¨Ø§Ú©Ø³ Ù¾ÛŒØ§Ù… Ø¨Ø§ SVG Ùˆ auto-hide */
    let msgTimeout = null;
    function showMessage(type, text) {
      const box = document.getElementById('messageBox');
      box.className = '';
      box.classList.add(type);
      box.innerHTML = iconForType(type) + text;
      box.style.display = 'block';
      if (msgTimeout) clearTimeout(msgTimeout);
      msgTimeout = setTimeout(() => { box.style.display = 'none'; }, 3000);
    }
    function iconForType(type){
      if(type==='success') return '<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="#155724" viewBox="0 0 24 24"><path d="M20.285 6.709l-11.285 11.291-5.285-5.291 1.414-1.414 3.871 3.877 9.871-9.877z"/></svg>';
      if(type==='error')   return '<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="#721c24" viewBox="0 0 24 24"><path d="M12 0C5.373 0 0 5.373 0 12s5.373 12 12 12 12-5.373 12-12S18.627 0 12 0zm1 17h-2v-2h2v2zm0-4h-2V7h2v6z"/></svg>';
      if(type==='warning') return '<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="#856404" viewBox="0 0 24 24"><path d="M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z"/></svg>';
      return '';
    }

    /* Ù†Ø±Ù…Ø§Ù„â€ŒØ³Ø§Ø²ÛŒ: Ø§Ø±Ù‚Ø§Ù… ÙØ§Ø±Ø³ÛŒ Ø¨Ù‡ Ù„Ø§ØªÛŒÙ† */
    function normalizeDigits(text) { return text.replace(/[Û°-Û¹]/g, d => faToEnDigit[d]); }

    /* Ù…ØªÙ† â Ù…ÙˆØ±Ø³ */
    function convertToMorse() {
      const raw = document.getElementById('inputText').value;
      if (!raw.trim()) {
        document.getElementById('outputMorse').innerText = "";
        showMessage('warning', 'ğŸ”” Ú†ÛŒØ²ÛŒ ÙˆØ§Ø±Ø¯ Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª!');
        return;
      }
      const text = normalizeDigits(raw);
      const words = text.split(/\s+/);
      let invalidFound = false;

      const morseWords = words.map(word => {
        const codes = [];
        for (const ch of word) {
          const upper = ch.toUpperCase();
          if (morseDigits[upper]) { codes.push(morseDigits[upper]); continue; }
          if (morsePunct[ch] !== undefined) { codes.push(morsePunct[ch]); continue; }
          if (morseMapFa[ch] !== undefined) { codes.push(morseMapFa[ch]); continue; }
          if (morseMapEn[upper] !== undefined) { codes.push(morseMapEn[upper]); continue; }
          invalidFound = true;
        }
        return codes.join(' ');
      });

      const result = morseWords.join('   ').trim();
      document.getElementById('outputMorse').innerText = result;

      if (invalidFound) showMessage('error', 'âŒ ÙˆØ±ÙˆØ¯ÛŒ ÙˆØ§Ø±Ø¯ Ø´Ø¯Ù‡ Ø§Ø´ØªØ¨Ø§Ù‡ Ø§Ø³Øª!');
      else showMessage('success', 'âœ… ØªØ¨Ø¯ÛŒÙ„ Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯.');
    }

    /* ØªØ´Ø®ÛŒØµ Ø²Ø¨Ø§Ù† Ø¨Ø±Ø§ÛŒ Ù‡Ø± Ú©Ù„Ù…Ù‡Ù” Ù…ÙˆØ±Ø³ Ø¨Ø§ ØªØ±Ø¬ÛŒØ­ currentLang Ø¯Ø± Ø­Ø§Ù„Øª Ù…Ø³Ø§ÙˆÛŒ */
    function detectLangForWord(letterCodes) {
      let faScore = 0, enScore = 0;
      for (const code of letterCodes) {
        if (revDigits[code] !== undefined || revPunct[code] !== undefined) continue;
        if (revFa[code] !== undefined) faScore++;
        if (revEn[code] !== undefined) enScore++;
      }
      if (faScore > enScore) return 'fa';
      if (enScore > faScore) return 'en';
      return currentLang; // ØªØ±Ø¬ÛŒØ­ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ø§Ø±Ø¨Ø± Ø¯Ø± Ø­Ø§Ù„Øª Ù…Ø³Ø§ÙˆÛŒ
    }

    /* Ù…ÙˆØ±Ø³ â Ù…ØªÙ† */
    function convertToText() {
      const input = document.getElementById('inputMorse').value.trim();
      if (!input) {
        document.getElementById('outputText').innerText = "";
        showMessage('warning', 'ğŸ”” Ú†ÛŒØ²ÛŒ ÙˆØ§Ø±Ø¯ Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª!');
        return;
      }

      const wordCodes = input.split(/\s{3}/); // Ø³Ù‡ ÙØ§ØµÙ„Ù‡ Ø¨ÛŒÙ† Ú©Ù„Ù…Ø§Øª
      let invalidFound = false;
      const decodedWords = [];

      for (const wordCode of wordCodes) {
        const letterCodes = wordCode.split(/\s+/).filter(Boolean);
        const langForWord = detectLangForWord(letterCodes);

        const letters = letterCodes.map(code => {
          // Ø§Ø¹Ø¯Ø§Ø¯
          if (revDigits[code] !== undefined) {
            const d = revDigits[code];
            return (langForWord === 'fa') ? enToFaDigit[d] : d;
          }
          // Ø¹Ù„Ø§Ø¦Ù… (Ø³Ø¤Ø§Ù„ ÙØ§Ø±Ø³ÛŒ/Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ)
          if (revPunct[code] !== undefined) {
            if (code === '..--..') return (langForWord === 'fa') ? 'ØŸ' : '?';
            return revPunct[code];
          }
          // Ø­Ø±ÙˆÙ
          if (langForWord === 'en' && revEn[code] !== undefined) return revEn[code];
          if (langForWord === 'fa' && revFa[code] !== undefined) return revFa[code];

          invalidFound = true;
          return '';
        });

        decodedWords.push(letters.join(''));
      }

      const result = decodedWords.join(' ');
      const out = document.getElementById('outputText');
      out.innerText = result;

      // Ø¬Ù‡Øª Ù†Ù…Ø§ÛŒØ´ Ø®Ø±ÙˆØ¬ÛŒ Ø¨Ø± Ø§Ø³Ø§Ø³ ØºØ§Ù„Ø¨ Ø¨ÙˆØ¯Ù† Ø²Ø¨Ø§Ù†
      const enWords = decodedWords.filter(w => /^[A-Za-z0-9?!"',.;:()/_&=+\-@$]*$/.test(w)).length;
      const displayLang = (enWords > (decodedWords.length - enWords)) ? 'en' : 'fa';
      out.style.direction = (displayLang === 'fa') ? 'rtl' : 'ltr';
      out.style.textAlign = (displayLang === 'fa') ? 'right' : 'left';

      if (invalidFound) showMessage('error', 'âŒ ÙˆØ±ÙˆØ¯ÛŒ ÙˆØ§Ø±Ø¯ Ø´Ø¯Ù‡ Ø§Ø´ØªØ¨Ø§Ù‡ Ø§Ø³Øª!');
      else showMessage('success', 'âœ… ØªØ¨Ø¯ÛŒÙ„ Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯.');
    }

    /* Ú©Ù¾ÛŒ Ø¨Ø§ Ù¾ÛŒØ§Ù… */
    function copyText(elementId) {
      const text = document.getElementById(elementId).innerText;
      if (!text.trim()) {
        showMessage('warning', 'ğŸ”” Ú†ÛŒØ²ÛŒ Ø¨Ø±Ø§ÛŒ Ú©Ù¾ÛŒ Ú©Ø±Ø¯Ù† ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯!');
        return;
      }
      navigator.clipboard.writeText(text)
        .then(() => showMessage('success', 'âœ… Ù…ØªÙ† Ú©Ù¾ÛŒ Ø´Ø¯!'))
        .catch(() => showMessage('error', 'âŒ Ø¯Ø³ØªØ±Ø³ÛŒ Ú©Ù¾ÛŒ Ø§Ù…Ú©Ø§Ù†â€ŒÙ¾Ø°ÛŒØ± Ù†ÛŒØ³Øª.'));
    }

    /* Ø¬Ø§ÛŒÚ¯Ø°Ø§Ø±ÛŒ Ø¨Ø§ Ù¾ÛŒØ§Ù… */
    function pasteText(inputId) {
      if (!navigator.clipboard || !navigator.clipboard.readText) {
        showMessage('error', 'âŒ Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ù‡ Ú©Ù„ÛŒÙ¾â€ŒØ¨ÙˆØ±Ø¯ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ù†Ù…ÛŒâ€ŒØ´ÙˆØ¯.');
        return;
      }
      navigator.clipboard.readText()
        .then(txt => {
          document.getElementById(inputId).value = txt;
          showMessage('success', 'âœ… Ù…ØªÙ† Ø§Ø² Ú©Ù„ÛŒÙ¾â€ŒØ¨ÙˆØ±Ø¯ Ø¬Ø§ÛŒÚ¯Ø°Ø§Ø±ÛŒ Ø´Ø¯.');
        })
        .catch(() => showMessage('error', 'âŒ Ø®ÙˆØ§Ù†Ø¯Ù† Ú©Ù„ÛŒÙ¾â€ŒØ¨ÙˆØ±Ø¯ Ù…Ù…Ú©Ù† Ù†ÛŒØ³Øª.'));
    }

    /* Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ø³Ø±ÛŒØ¹ Ø¨Ø§ Ø³Ø·Ù„ SVG */
    function clearInput(inputId){
      const el = document.getElementById(inputId);
      if (!el.value.trim()) {
        showMessage('warning', 'ğŸ”” Ù…ØªÙ†ÛŒ Ø¯Ø± Ú©Ø§Ø¯Ø± ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯!');
        return;
      }
      el.value = '';
      showMessage('success', 'ğŸ—‘ï¸ ÙˆØ±ÙˆØ¯ÛŒ Ù¾Ø§Ú© Ø´Ø¯.');
    }

    /* Ù¾Ø®Ø´ ØµÙˆØªÛŒ Ù…ÙˆØ±Ø³ (Ø§Ø³Ù¾ÛŒÚ©Ø± Ø¨Ø§Ù„Ø§-Ø±Ø§Ø³Øª) */
    function playMorseAudio(){
      const morse = document.getElementById('outputMorse').innerText.trim();
      if (!morse) { showMessage('warning', 'ğŸ”” Ø®Ø±ÙˆØ¬ÛŒ Ù…ÙˆØ±Ø³ Ø®Ø§Ù„ÛŒ Ø§Ø³Øª!'); return; }

      const ctx = new (window.AudioContext || window.webkitAudioContext)();
      const dot = 0.08;      // Ø·ÙˆÙ„ Ù†Ù‚Ø·Ù‡ (Ø«Ø§Ù†ÛŒÙ‡)
      const dash = dot * 3;  // Ø·ÙˆÙ„ Ø®Ø·
      const gapIntra = dot;  // ÙØ§ØµÙ„Ù‡ Ø¨ÛŒÙ† Ù†Ø´Ø§Ù†Ù‡â€ŒÙ‡Ø§ÛŒ ÛŒÚ© Ø­Ø±Ù
      const gapLetter = dot * 3; // ÙØ§ØµÙ„Ù‡ Ø¨ÛŒÙ† Ø­Ø±ÙˆÙ
      const gapWord = dot * 7;   // ÙØ§ØµÙ„Ù‡ Ø¨ÛŒÙ† Ú©Ù„Ù…Ø§Øª

      let t = ctx.currentTime;
      const words = morse.split(/\s{3}/);
      function beep(duration){
        const o = ctx.createOscillator();
        const g = ctx.createGain();
        o.type = 'sine';
        o.frequency.value = 700;
        g.gain.setValueAtTime(0.0001, t);
        g.gain.exponentialRampToValueAtTime(0.4, t + 0.01);
        o.connect(g); g.connect(ctx.destination);
        o.start(t); o.stop(t + duration);
        t += duration;
      }
      words.forEach((w, wi) => {
        const letters = w.trim().split(/\s+/);
        letters.forEach((letter, li) => {
          for (const ch of letter) {
            if (ch === '.') { beep(dot); }
            else if (ch === '-') { beep(dash); }
            t += gapIntra;
          }
          t += (gapLetter - gapIntra);
        });
        if (wi < words.length - 1) t += (gapWord - gapLetter);
      });
      showMessage('success', 'ğŸ”Š Ù¾Ø®Ø´ ØµÙˆØªÛŒ Ù…ÙˆØ±Ø³ Ø¢ØºØ§Ø² Ø´Ø¯.');
    }

    /* Ø³ÙˆØ¦ÛŒÚ† Ø²Ø¨Ø§Ù† ØªØ±Ø¬ÛŒØ­ÛŒ Ø¨Ø±Ø§ÛŒ Ù…ÙˆØ±Ø³ â Ù…ØªÙ† */
    function toggleLang() {
      currentLang = (currentLang === 'fa') ? 'en' : 'fa';
      document.getElementById('langLabel').innerText = (currentLang === 'fa') ? 'ÙØ§Ø±Ø³ÛŒ' : 'English';
      showMessage('success', 'ğŸŒ Ø²Ø¨Ø§Ù† ØªØ¨Ø¯ÛŒÙ„: ' + (currentLang === 'fa' ? 'ÙØ§Ø±Ø³ÛŒ' : 'English'));
    }
  </script>
</body>
</html>